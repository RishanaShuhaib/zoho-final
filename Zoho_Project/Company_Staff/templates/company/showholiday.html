{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
  body {
    background: black !important;
  }

  .btn-custom {
    background: none !important;
    color: orange !important;
    border: 1px solid orange !important;
  }

  /* Hover effect */
  .btn-custom:hover {
    background: orange !important;
    color: white !important;
  }
</style>

<div class="body-wrapper">
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb" style="background: black !important; color: orange !important;">
        <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
        <li class="breadcrumb-item" aria-current="page">Godown Details</li>
      </ol>
    </nav>
    <p class="display-5 text-center" style="color: white;">Godown Details</p>

    <div class="container-fluid">
      <div class="d-flex flex-wrap align-items-center" style="padding: 5px;">

        <div class="d-flex flex-wrap">
          <input type="text" id="searchInput" placeholder="Search Here..." class="mr-2 d-inline form-control mb-2 mb-md-0" style="width: 150px;">
          <button onclick="searchTable()" class="btn btn-custom ml-md-2 mb-2 mb-md-0" style="padding-right: 5px;"><i class="fas fa-search"></i></button>
        </div>

        <div class="ml-md-3">
          <div class="input-group">
            <div class="input-group-prepend">
              <button class="btn btn-custom dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false"><i class="fas fa-sort"></i></button>
              <div class="dropdown-menu" style="color:white;">
                <a class="dropdown-item" href="#">A</a>
                <a class="dropdown-item" href="#">B</a>
                <a class="dropdown-item" href="#">C</a>
              </div>
            </div>
          </div>
        </div>

        <div class="ml-md-3">
          <div class="input-group">
            <div class="input-group-prepend">
              <button class="btn btn-custom dropdown-toggle " type="button" data-toggle="dropdown" aria-expanded="false"><i class="fas fa-filter"></i></button>
              <div class="dropdown-menu" style="color:white;">
                <a class="dropdown-item" href="#" onclick="applyFilter('A')">A</a>
                <a class="dropdown-item" href="#" onclick="applyFilter('B')">B</a>
                <a class="dropdown-item" href="#" onclick="applyFilter('C')">C</a>
              </div>
            </div>
          </div>
        </div>

        <div class="ml-md-5">
          <div class="input-group">
            <a href="#" class="btn btn-custom ml-md-5" onclick="importData()">
              Import <i class="fas fa-upload"></i>
            </a>
          </div>
        </div>

        <div class="ml-md-1">
          <div class="input-group">
            <a href="#" class="btn btn-custom" onclick="exportData()" style="margin-left: 1px;">
              Export <i class="fas fa-file-export"></i>
            </a>
          </div>
        </div>

        <div class="ml-md-auto">
          <a href="{% url 'add_godown' %}" class="btn btn-custom" style="margin-left: 15px;">
            New <i class="fas fa-plus"></i>
          </a>
        </div>

      </div>
    </div>

    <div class="table-responsive">
      <table class="table mt-lg-5 mt-2 rounded" style="background-color: rgb(0, 0, 0); color: white;">
        <thead>
          <tr class="border-bottom border-dark">
            <th scope="col"><b>Date</b></th>
            <th scope="col"><b>Name</b></th>
            <th scope="col"><b>Item</b></th>
            <th scope="col"><b>Quantity</b></th>
            <th scope="col"><b>Status</b></th>
            <th scope="col"><b>Action</b></th>
          </tr>
        </thead>
        <tbody>
          {% for godown in godowns %}
          <tr class="border-bottom border-dark">
            <td>{{ godown.date }}</td>
            <td>{{ godown.godown_name }}</td>
            <td>
              {% if godown.item %}
              {{ godown.item.item_name }}
              {% else %}
              N/A
              {% endif %}
            </td>
            <td>{{ godown.stock_keeping }}</td>
            <td>
              {{ godown.item.is_active }}
            </td>
            <td>
              <a href="{% url 'delete_godown' godown.id %}" style="color: white;">
                <i class="fas fa-trash"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
          {% if godowns|length == 0 %}
          <tr class="border-bottom border-dark">
            <td colspan="6">No godowns to display.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
<script>
  function searchTable() {
    // Declare variables
    var input, filter, table, tr, td, i, j, txtValue;
    input = document.getElementById("searchInput");
    filter = input.value.toUpperCase();
    table = document.querySelector(".table");
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows
    for (i = 0; i < tr.length; i++) {
      // Skip the rows in thead
      if (tr[i].getElementsByTagName("th").length > 0) {
        continue;
      }

      var found = false;

      // Loop through all columns in the current row
      for (j = 0; j < tr[i].cells.length; j++) {
        td = tr[i].getElementsByTagName("td")[j];

        if (td) {
          txtValue = td.textContent || td.innerText;

          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            found = true;
            break;
          }
        }
      }

      // Set display based on search result
      if (found) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }

  function importData() {
    var input = document.createElement('input');
    input.type = 'file';

    input.onchange = function (e) {
      var file = e.target.files[0];
      if (!file) return;

      var reader = new FileReader();
      reader.onload = function (e) {
        var data = new Uint8Array(e.target.result);
        var workbook = XLSX.read(data, {
          type: 'array'
        });
        var sheetName = workbook.SheetNames[0];
        var sheet = workbook.Sheets[sheetName];
        var jsonData = XLSX.utils.sheet_to_json(sheet, {
          header: 1
        });

        // Assuming your table has a specific format, modify this part accordingly
        // Clear existing table data
        var tableBody = document.querySelector("table tbody");
        tableBody.innerHTML = "";

        // Populate table with imported data
        for (var i = 0; i < jsonData.length; i++) {
          var row = jsonData[i];
          var tr = document.createElement("tr");
          for (var j = 0; j < row.length; j++) {
            var td = document.createElement("td");
            td.textContent = row[j];
            tr.appendChild(td);
          }
          tableBody.appendChild(tr);
        }
      };

      reader.readAsArrayBuffer(file);
    };

    input.click();
  }

  function exportData() {
    // Get the table element by its class
    var table = document.querySelector(".table");
    // Convert the table to a sheet
    var sheet = XLSX.utils.table_to_sheet(table);
    // Create a workbook and add the sheet
    var workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, sheet, "Sheet1");

    // Save the workbook to an Excel file
    XLSX.writeFile(workbook, "godown_details.xlsx");
  }
</script>

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

{% endblock %}
